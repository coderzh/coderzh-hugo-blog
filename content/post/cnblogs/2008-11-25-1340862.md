---
categories:
- 技术文章
date: '2008-11-25'
title: C# 中使用JSON - DataContractJsonSerializer
url: /2008/11/25/1340862/

---


C#中使用JSON不需要使用第三方库，使用.NET Framwork3.5自带的System.Runtime.Serialization.Json即可很好的完成JSON的解析。

关于JSON的入门介绍见(首页的图很形象)：
  
[http://www.json.org/](http://www.json.org/) 

#### 一、Using

需要添加引用：System.ServiceModel.Web 和 System.Runtime.Serialization，然后使用Using：

<div class="cnblogs_code"><span style="color: #0000ff;">using</span><span style="color: #000000;">&nbsp;System.Runtime.Serialization.Json;
<br />
</span><span style="color: #0000ff;">using</span><span style="color: #000000;">&nbsp;System.Runtime.Serialization;</span></div>

#### &nbsp;二、定义序列化的类

假如我们要转化的JSON字符串格式为：

<div class="cnblogs_code"><span style="color: #000000;">{
<br />
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">encoding</span><span style="color: #800000;">"</span><span style="color: #000000;">:</span><span style="color: #800000;">"</span><span style="color: #800000;">UTF-8</span><span style="color: #800000;">"</span><span style="color: #000000;">,
<br />
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">plug-ins</span><span style="color: #800000;">"</span><span style="color: #000000;">:[</span><span style="color: #800000;">"</span><span style="color: #800000;">python</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">c++</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">ruby</span><span style="color: #800000;">"</span><span style="color: #000000;">],
<br />
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">indent</span><span style="color: #800000;">"</span><span style="color: #000000;">:{
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">length</span><span style="color: #800000;">"</span><span style="color: #000000;">:</span><span style="color: #800080;">3</span><span style="color: #000000;">,
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">use_space</span><span style="color: #800000;">"</span><span style="color: #000000;">:</span><span style="color: #0000ff;">true</span><span style="color: #000000;">
<br />
&nbsp;&nbsp;&nbsp;&nbsp;}
<br />
}</span></div>

然后编写相应的序列化的类，注意下面类加的Attribute：

<div class="cnblogs_code">![](http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif)![](http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif)<span id="Code_Closed_Text_193256" class="cnblogs_code_Collapse">JSON Object</span><span id="Code_Open_Text_193256" style="display: none;"><span style="color: #000000;">[DataContract(Namespace&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">http://coderzh.cnblogs.com</span><span style="color: #800000;">"</span><span style="color: #000000;">)]
<br />
</span><span style="color: #0000ff;">class</span><span style="color: #000000;">&nbsp;Config
<br />
{
<br />
&nbsp;&nbsp;&nbsp;&nbsp;[DataMember(Order&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">0</span><span style="color: #000000;">)]
<br />
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">string</span><span style="color: #000000;">&nbsp;encoding&nbsp;{&nbsp;</span><span style="color: #0000ff;">get</span><span style="color: #000000;">;&nbsp;</span><span style="color: #0000ff;">set</span><span style="color: #000000;">;&nbsp;}
<br />
&nbsp;&nbsp;&nbsp;&nbsp;[DataMember(Order&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">1</span><span style="color: #000000;">)]
<br />
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">string</span><span style="color: #000000;">[]&nbsp;plugins&nbsp;{&nbsp;</span><span style="color: #0000ff;">get</span><span style="color: #000000;">;&nbsp;</span><span style="color: #0000ff;">set</span><span style="color: #000000;">;&nbsp;}
<br />
&nbsp;&nbsp;&nbsp;&nbsp;[DataMember(Order&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">2</span><span style="color: #000000;">)]
<br />
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;">&nbsp;Indent&nbsp;indent&nbsp;{&nbsp;</span><span style="color: #0000ff;">get</span><span style="color: #000000;">;&nbsp;</span><span style="color: #0000ff;">set</span><span style="color: #000000;">;&nbsp;}
<br />
}
  
[DataContract(Namespace&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">http://coderzh.cnblogs.com</span><span style="color: #800000;">"</span><span style="color: #000000;">)]
<br />
</span><span style="color: #0000ff;">class</span><span style="color: #000000;">&nbsp;Indent
<br />
{
<br />
&nbsp;&nbsp;&nbsp;&nbsp;[DataMember(Order&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">0</span><span style="color: #000000;">)]
<br />
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">int</span><span style="color: #000000;">&nbsp;length&nbsp;{&nbsp;</span><span style="color: #0000ff;">get</span><span style="color: #000000;">;&nbsp;</span><span style="color: #0000ff;">set</span><span style="color: #000000;">;&nbsp;}
<br />
&nbsp;&nbsp;&nbsp;&nbsp;[DataMember(Order&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">1</span><span style="color: #000000;">)]
<br />
&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000ff;">public</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">bool</span><span style="color: #000000;">&nbsp;use_space&nbsp;{&nbsp;</span><span style="color: #0000ff;">get</span><span style="color: #000000;">;&nbsp;</span><span style="color: #0000ff;">set</span><span style="color: #000000;">;&nbsp;}
<br />
}</span></span></div>

#### 三、对象转化为JSON字符串

使用WriteObject方法：

<div class="cnblogs_code">![](http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif)![](http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif)<span id="Code_Closed_Text_193510" class="cnblogs_code_Collapse">WriteObject</span><span id="Code_Open_Text_193510" style="display: none;">
<br />
<span style="color: #000000;">var&nbsp;config&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">new</span><span style="color: #000000;">&nbsp;Config(){
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;encoding&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">UTF-8</span><span style="color: #800000;">"</span><span style="color: #000000;">,
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plugins&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">new</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">string</span><span style="color: #000000;">[]{</span><span style="color: #800000;">"</span><span style="color: #800000;">python</span><span style="color: #800000;">"</span><span style="color: #000000;">,&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">C++</span><span style="color: #800000;">"</span><span style="color: #000000;">,&nbsp;</span><span style="color: #800000;">"</span><span style="color: #800000;">C#</span><span style="color: #800000;">"</span><span style="color: #000000;">},
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indent&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">new</span><span style="color: #000000;">&nbsp;Indent(){&nbsp;length&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">4</span><span style="color: #000000;">,&nbsp;use_space&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">false</span><span style="color: #000000;">}
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};
<br />
var&nbsp;serializer&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">new</span><span style="color: #000000;">&nbsp;DataContractJsonSerializer(</span><span style="color: #0000ff;">typeof</span><span style="color: #000000;">(Config));
<br />
var&nbsp;stream&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">new</span><span style="color: #000000;">&nbsp;MemoryStream();
<br />
serializer.WriteObject(stream,&nbsp;config);
<br />
</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">[]&nbsp;dataBytes&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">new</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">[stream.Length];
<br />
stream.Position&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #800080;">0</span><span style="color: #000000;">;
<br />
stream.Read(dataBytes,&nbsp;</span><span style="color: #800080;">0</span><span style="color: #000000;">,&nbsp;(</span><span style="color: #0000ff;">int</span><span style="color: #000000;">)stream.Length);
<br />
</span><span style="color: #0000ff;">string</span><span style="color: #000000;">&nbsp;dataString&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;Encoding.UTF8.GetString(dataBytes);
<br />
Console.WriteLine(</span><span style="color: #800000;">"</span><span style="color: #800000;">JSON&nbsp;string&nbsp;is:</span><span style="color: #800000;">"</span><span style="color: #000000;">);
<br />
Console.WriteLine(dataString);</span></span></div>

#### 四、JSON字符串转对象

使用ReadObject方法： 

<div class="cnblogs_code">![](http://www.cnblogs.com/Images/OutliningIndicators/ContractedBlock.gif)![](http://www.cnblogs.com/Images/OutliningIndicators/ExpandedBlockStart.gif)<span id="Code_Closed_Text_193650" class="cnblogs_code_Collapse">ReadObject</span><span id="Code_Open_Text_193650" style="display: none;">
<br />
<span style="color: #000000;">var&nbsp;mStream&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">new</span><span style="color: #000000;">&nbsp;MemoryStream(Encoding.Default.GetBytes(dataString));
<br />
Config&nbsp;readConfig&nbsp;</span><span style="color: #000000;">=</span><span style="color: #000000;">&nbsp;(Config)serializer.ReadObject(mStream);
<br />
Console.WriteLine(</span><span style="color: #800000;">"</span><span style="color: #800000;">Encoding&nbsp;is:&nbsp;{0}</span><span style="color: #800000;">"</span><span style="color: #000000;">,&nbsp;readConfig.encoding);
<br />
</span><span style="color: #0000ff;">foreach</span><span style="color: #000000;">&nbsp;(</span><span style="color: #0000ff;">string</span><span style="color: #000000;">&nbsp;plugin&nbsp;</span><span style="color: #0000ff;">in</span><span style="color: #000000;">&nbsp;readConfig.plugins)
<br />
{
<br />
&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span><span style="color: #800000;">"</span><span style="color: #800000;">plugins&nbsp;is:&nbsp;{0}</span><span style="color: #800000;">"</span><span style="color: #000000;">,&nbsp;plugin);
<br />
}
<br />
Console.WriteLine(</span><span style="color: #800000;">"</span><span style="color: #800000;">indent.length&nbsp;is:&nbsp;{0}</span><span style="color: #800000;">"</span><span style="color: #000000;">,&nbsp;readConfig.indent.length);
<br />
Console.WriteLine(</span><span style="color: #800000;">"</span><span style="color: #800000;">indent.use_space&nbsp;is:&nbsp;{0}</span><span style="color: #800000;">"</span><span style="color: #000000;">,&nbsp;readConfig.indent.use_space);</span></span></div>

#### &nbsp;五、输出结果：

<div class="cnblogs_code"><span style="color: #000000;">JSON&nbsp;</span><span style="color: #0000ff;">string</span><span style="color: #000000;">&nbsp;</span><span style="color: #0000ff;">is</span><span style="color: #000000;">:
<br />
{</span><span style="color: #800000;">"</span><span style="color: #800000;">encoding</span><span style="color: #800000;">"</span><span style="color: #000000;">:</span><span style="color: #800000;">"</span><span style="color: #800000;">UTF-8</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">plugins</span><span style="color: #800000;">"</span><span style="color: #000000;">:[</span><span style="color: #800000;">"</span><span style="color: #800000;">python</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">C++</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">C#</span><span style="color: #800000;">"</span><span style="color: #000000;">],</span><span style="color: #800000;">"</span><span style="color: #800000;">indent</span><span style="color: #800000;">"</span><span style="color: #000000;">:{</span><span style="color: #800000;">"</span><span style="color: #800000;">length</span><span style="color: #800000;">"</span><span style="color: #000000;">:</span><span style="color: #800080;">4</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">use_space</span><span style="color: #800000;">"</span><span style="color: #000000;">:</span><span style="color: #0000ff;">false</span><span style="color: #000000;">}}
<br />
Encoding&nbsp;</span><span style="color: #0000ff;">is</span><span style="color: #000000;">:&nbsp;UTF</span><span style="color: #000000;">-</span><span style="color: #800080;">8</span><span style="color: #000000;">
<br />
plugins&nbsp;</span><span style="color: #0000ff;">is</span><span style="color: #000000;">:&nbsp;python
<br />
plugins&nbsp;</span><span style="color: #0000ff;">is</span><span style="color: #000000;">:&nbsp;C</span><span style="color: #000000;">++</span><span style="color: #000000;">
<br />
plugins&nbsp;</span><span style="color: #0000ff;">is</span><span style="color: #000000;">:&nbsp;C#
<br />
indent.length&nbsp;</span><span style="color: #0000ff;">is</span><span style="color: #000000;">:&nbsp;</span><span style="color: #800080;">4</span><span style="color: #000000;">
<br />
indent.use_space&nbsp;</span><span style="color: #0000ff;">is</span><span style="color: #000000;">:&nbsp;False</span></div>

&nbsp;

**[温馨提示]：该文章由原博客园导入而来，如排版效果不佳，请移步：[http://www.cnblogs.com/coderzh/archive/2008/11/25/1340862.html](http://www.cnblogs.com/coderzh/archive/2008/11/25/1340862.html)**